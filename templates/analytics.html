<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZAMAN Bank - –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }

        .header h1 {
            color: #2E8B57;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.2em;
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .nav-btn {
            background: linear-gradient(135deg, #2E8B57 0%, #228B22 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            text-decoration: none;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46, 139, 87, 0.3);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #2E8B57;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #666;
            font-size: 1.1em;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .chart-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
            font-size: 1.2em;
        }

        .error {
            background: #ffebee;
            color: #c62828;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .tabs {
            display: flex;
            background: white;
            border-radius: 15px;
            padding: 10px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s;
            font-weight: 600;
        }

        .tab.active {
            background: linear-gradient(135deg, #2E8B57 0%, #228B22 100%);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .tabs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåø ZAMAN Bank Analytics</h1>
            <p>–ì–ª—É–±–æ–∫–∏–π –≤–∏–∑—É–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö –∏—Å–ª–∞–º—Å–∫–æ–≥–æ –±–∞–Ω–∫–∞</p>
            <div class="nav-buttons">
                <a href="/" class="nav-btn">üè† –ì–ª–∞–≤–Ω–∞—è</a>
                <a href="/analytics" class="nav-btn">üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</a>
            </div>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('overview')">üìà –û–±–∑–æ—Ä</div>
            <div class="tab" onclick="switchTab('transactions')">üí≥ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</div>
            <div class="tab" onclick="switchTab('users')">üë• –ö–ª–∏–µ–Ω—Ç—ã</div>
            <div class="tab" onclick="switchTab('products')">üì¶ –ü—Ä–æ–¥—É–∫—Ç—ã</div>
        </div>

        <!-- Overview Tab -->
        <div id="overview" class="tab-content active">
            <div class="stats-grid" id="overviewStats">
                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏...</div>
            </div>
            
            <div class="charts-grid">
                <div class="chart-container">
                    <div class="chart-title">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</div>
                    <div class="chart-wrapper">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">–°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤</div>
                    <div class="chart-wrapper">
                        <canvas id="segmentChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">–°—Ç–∞—Ç—É—Å –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∫–ª–∏–µ–Ω—Ç–æ–≤</div>
                    <div class="chart-wrapper">
                        <canvas id="productStatusChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">–ê–Ω–∞–ª–∏–∑ —ç–º–æ—Ü–∏–π –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö</div>
                    <div class="chart-wrapper">
                        <canvas id="emotionChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transactions Tab -->
        <div id="transactions" class="tab-content">
            <div class="charts-grid">
                <div class="chart-container">
                    <div class="chart-title">–ú–µ—Å—è—á–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</div>
                    <div class="chart-wrapper">
                        <canvas id="monthlyTrendsChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">–¢–∏–ø—ã –ø–ª–∞—Ç–µ–∂–µ–π</div>
                    <div class="chart-wrapper">
                        <canvas id="paymentTypeChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">–£—Ä–æ–≤–µ–Ω—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏</div>
                    <div class="chart-wrapper">
                        <canvas id="necessityChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">–¢–æ–ø –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ —Å—É–º–º–µ</div>
                    <div class="chart-wrapper">
                        <canvas id="topCategoriesChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Users Tab -->
        <div id="users" class="tab-content">
            <div class="charts-grid">
                <div class="chart-container">
                    <div class="chart-title">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å—Ç–∞–¥–∏—è–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</div>
                    <div class="chart-wrapper">
                        <canvas id="activityStageChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">–ö–ª–∞—Å—Ç–µ—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑</div>
                    <div class="chart-wrapper">
                        <canvas id="clusterChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">–¢–æ–ø –∫–ª–∏–µ–Ω—Ç—ã –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</div>
                    <div class="chart-wrapper">
                        <canvas id="topUsersTransactionsChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">–¢–æ–ø –∫–ª–∏–µ–Ω—Ç—ã –ø–æ —Å—É–º–º–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</div>
                    <div class="chart-wrapper">
                        <canvas id="topUsersAmountChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Products Tab -->
        <div id="products" class="tab-content">
            <div class="charts-grid">
                <div class="chart-container">
                    <div class="chart-title">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</div>
                    <div class="chart-wrapper">
                        <canvas id="productCategoryChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">–¢–∏–ø—ã –ø—Ä–∏–±—ã–ª–∏</div>
                    <div class="chart-wrapper">
                        <canvas id="profitTypeChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">–£—Ä–æ–≤–Ω–∏ —Ä–∏—Å–∫–∞</div>
                    <div class="chart-wrapper">
                        <canvas id="riskLevelChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">–°—Ä–æ–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</div>
                    <div class="chart-wrapper">
                        <canvas id="termChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class ZamanAnalytics {
            constructor() {
                this.charts = {};
                this.data = {};
                this.init();
            }

            async init() {
                await this.loadAllData();
                this.renderOverviewStats();
                this.createOverviewCharts();
            }

            async loadAllData() {
                try {
                    console.log('Loading analytics data...');
                    const [overview, transactions, users, products] = await Promise.all([
                        fetch('/api/analytics/overview').then(r => r.json()),
                        fetch('/api/analytics/transactions').then(r => r.json()),
                        fetch('/api/analytics/users').then(r => r.json()),
                        fetch('/api/analytics/products').then(r => r.json())
                    ]);

                    console.log('Data loaded successfully');
                    this.data = { overview, transactions, users, products };
                } catch (error) {
                    console.error('Error loading data:', error);
                    this.showError(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ${error.message}`);
                }
            }

            renderOverviewStats() {
                const statsContainer = document.getElementById('overviewStats');
                const overview = this.data.overview.overview;

                statsContainer.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-number">${overview.total_users.toLocaleString()}</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${overview.total_transactions.toLocaleString()}</div>
                        <div class="stat-label">–í—Å–µ–≥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${overview.total_products.toLocaleString()}</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${overview.total_user_products.toLocaleString()}</div>
                        <div class="stat-label">–ü—Ä–æ–¥—É–∫—Ç–æ–≤ —É –∫–ª–∏–µ–Ω—Ç–æ–≤</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${(overview.total_amount / 1000000).toFixed(1)}M ‚Ç∏</div>
                        <div class="stat-label">–û–±—â–∞—è —Å—É–º–º–∞</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${overview.avg_transaction.toLocaleString()} ‚Ç∏</div>
                        <div class="stat-label">–°—Ä–µ–¥–Ω—è—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è</div>
                    </div>
                `;
            }

            createOverviewCharts() {
                this.createCategoryChart();
                this.createSegmentChart();
                this.createProductStatusChart();
                this.createEmotionChart();
            }

            createTabCharts(tabName) {
                console.log(`Creating charts for tab: ${tabName}`);
                
                switch(tabName) {
                    case 'transactions':
                        this.createMonthlyTrendsChart();
                        this.createPaymentTypeChart();
                        this.createNecessityChart();
                        this.createTopCategoriesChart();
                        break;
                    case 'users':
                        this.createActivityStageChart();
                        this.createClusterChart();
                        this.createTopUsersTransactionsChart();
                        this.createTopUsersAmountChart();
                        break;
                    case 'products':
                        this.createProductCategoryChart();
                        this.createProfitTypeChart();
                        this.createRiskLevelChart();
                        this.createTermChart();
                        break;
                }
            }

            createCategoryChart() {
                try {
                    const ctx = document.getElementById('categoryChart').getContext('2d');
                    const data = this.data.overview.categories;
                    
                    this.charts.categoryChart = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: Object.keys(data),
                            datasets: [{
                                data: Object.values(data).map(item => item.amount_sum),
                                backgroundColor: ['#2E8B57', '#228B22', '#32CD32', '#90EE90', '#98FB98', '#00FF7F', '#00FA9A', '#3CB371']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { position: 'bottom' } }
                        }
                    });
                } catch (error) {
                    console.error('Error creating category chart:', error);
                }
            }

            createSegmentChart() {
                try {
                    const ctx = document.getElementById('segmentChart').getContext('2d');
                    const data = this.data.overview.segments;
                    
                    this.charts.segmentChart = new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: Object.keys(data),
                            datasets: [{
                                data: Object.values(data),
                                backgroundColor: ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe', '#00f2fe', '#43e97b', '#38f9d7']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { position: 'bottom' } }
                        }
                    });
                } catch (error) {
                    console.error('Error creating segment chart:', error);
                }
            }

            createProductStatusChart() {
                try {
                    const ctx = document.getElementById('productStatusChart').getContext('2d');
                    const data = this.data.overview.user_products;
                    
                    this.charts.productStatusChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: Object.keys(data),
                            datasets: [{
                                label: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ',
                                data: Object.values(data),
                                backgroundColor: '#2E8B57'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { display: false } }
                        }
                    });
                } catch (error) {
                    console.error('Error creating product status chart:', error);
                }
            }

            createEmotionChart() {
                try {
                    const ctx = document.getElementById('emotionChart').getContext('2d');
                    const data = this.data.transactions.emotion_analysis;
                    
                    this.charts.emotionChart = new Chart(ctx, {
                        type: 'polarArea',
                        data: {
                            labels: Object.keys(data),
                            datasets: [{
                                data: Object.values(data),
                                backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { position: 'bottom' } }
                        }
                    });
                } catch (error) {
                    console.error('Error creating emotion chart:', error);
                }
            }

            createMonthlyTrendsChart() {
                try {
                    const ctx = document.getElementById('monthlyTrendsChart').getContext('2d');
                    const data = this.data.transactions.monthly_trends;
                    
                    this.charts.monthlyTrendsChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: Object.keys(data),
                            datasets: [{
                                label: '–°—É–º–º–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π',
                                data: Object.values(data).map(item => item.amount_sum),
                                borderColor: '#2E8B57',
                                backgroundColor: 'rgba(46, 139, 87, 0.1)',
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: { y: { beginAtZero: true } }
                        }
                    });
                } catch (error) {
                    console.error('Error creating monthly trends chart:', error);
                }
            }

            createPaymentTypeChart() {
                try {
                    const ctx = document.getElementById('paymentTypeChart').getContext('2d');
                    const data = this.data.transactions.payment_type_analysis;
                    
                    this.charts.paymentTypeChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: Object.keys(data),
                            datasets: [{
                                label: '–°—É–º–º–∞',
                                data: Object.values(data),
                                backgroundColor: ['#667eea', '#764ba2', '#f093fb']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { display: false } }
                        }
                    });
                } catch (error) {
                    console.error('Error creating payment type chart:', error);
                }
            }

            createNecessityChart() {
                try {
                    const ctx = document.getElementById('necessityChart').getContext('2d');
                    const data = this.data.transactions.necessity_analysis;
                    
                    this.charts.necessityChart = new Chart(ctx, {
                        type: 'radar',
                        data: {
                            labels: Object.keys(data).map(key => `–£—Ä–æ–≤–µ–Ω—å ${key}`),
                            datasets: [{
                                label: '–°—É–º–º–∞',
                                data: Object.values(data),
                                backgroundColor: 'rgba(46, 139, 87, 0.2)',
                                borderColor: '#2E8B57',
                                pointBackgroundColor: '#2E8B57'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: { r: { beginAtZero: true } }
                        }
                    });
                } catch (error) {
                    console.error('Error creating necessity chart:', error);
                }
            }

            createTopCategoriesChart() {
                try {
                    const ctx = document.getElementById('topCategoriesChart').getContext('2d');
                    const data = this.data.transactions.category_breakdown;
                    const sortedData = Object.entries(data).sort(([,a], [,b]) => b - a).slice(0, 8);
                    
                    this.charts.topCategoriesChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: sortedData.map(([key]) => key),
                            datasets: [{
                                label: '–°—É–º–º–∞',
                                data: sortedData.map(([,value]) => value),
                                backgroundColor: '#2E8B57'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            indexAxis: 'y',
                            plugins: { legend: { display: false } }
                        }
                    });
                } catch (error) {
                    console.error('Error creating top categories chart:', error);
                }
            }

            createActivityStageChart() {
                try {
                    const ctx = document.getElementById('activityStageChart').getContext('2d');
                    const data = this.data.users.activity_stage_distribution;
                    
                    this.charts.activityStageChart = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: Object.keys(data),
                            datasets: [{
                                data: Object.values(data),
                                backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40', '#FF6384', '#36A2EB']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { position: 'bottom' } }
                        }
                    });
                } catch (error) {
                    console.error('Error creating activity stage chart:', error);
                }
            }

            createClusterChart() {
                try {
                    const ctx = document.getElementById('clusterChart').getContext('2d');
                    const data = this.data.users.cluster_distribution;
                    
                    this.charts.clusterChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: Object.keys(data).map(key => `–ö–ª–∞—Å—Ç–µ—Ä ${key}`),
                            datasets: [{
                                label: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–æ–≤',
                                data: Object.values(data),
                                backgroundColor: '#667eea'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { display: false } }
                        }
                    });
                } catch (error) {
                    console.error('Error creating cluster chart:', error);
                }
            }

            createTopUsersTransactionsChart() {
                try {
                    const ctx = document.getElementById('topUsersTransactionsChart').getContext('2d');
                    const data = this.data.users.top_users_by_transactions;
                    
                    this.charts.topUsersTransactionsChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: Object.keys(data).map(key => `–ö–ª–∏–µ–Ω—Ç ${key}`),
                            datasets: [{
                                label: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π',
                                data: Object.values(data),
                                backgroundColor: '#2E8B57'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { display: false } }
                        }
                    });
                } catch (error) {
                    console.error('Error creating top users transactions chart:', error);
                }
            }

            createTopUsersAmountChart() {
                try {
                    const ctx = document.getElementById('topUsersAmountChart').getContext('2d');
                    const data = this.data.users.top_users_by_amount;
                    
                    this.charts.topUsersAmountChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: Object.keys(data).map(key => `–ö–ª–∏–µ–Ω—Ç ${key}`),
                            datasets: [{
                                label: '–°—É–º–º–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π',
                                data: Object.values(data),
                                backgroundColor: '#764ba2'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { display: false } }
                        }
                    });
                } catch (error) {
                    console.error('Error creating top users amount chart:', error);
                }
            }

            createProductCategoryChart() {
                try {
                    const ctx = document.getElementById('productCategoryChart').getContext('2d');
                    const data = this.data.products.product_category_analysis;
                    
                    this.charts.productCategoryChart = new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: Object.keys(data),
                            datasets: [{
                                data: Object.values(data),
                                backgroundColor: ['#2E8B57', '#228B22', '#32CD32', '#90EE90', '#98FB98', '#00FF7F', '#00FA9A', '#3CB371']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { position: 'bottom' } }
                        }
                    });
                } catch (error) {
                    console.error('Error creating product category chart:', error);
                }
            }

            createProfitTypeChart() {
                try {
                    const ctx = document.getElementById('profitTypeChart').getContext('2d');
                    const data = this.data.products.profit_type_analysis;
                    
                    this.charts.profitTypeChart = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: Object.keys(data),
                            datasets: [{
                                data: Object.values(data),
                                backgroundColor: ['#667eea', '#764ba2', '#f093fb', '#f5576c']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { position: 'bottom' } }
                        }
                    });
                } catch (error) {
                    console.error('Error creating profit type chart:', error);
                }
            }

            createRiskLevelChart() {
                try {
                    const ctx = document.getElementById('riskLevelChart').getContext('2d');
                    const data = this.data.products.risk_level_analysis;
                    
                    this.charts.riskLevelChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: Object.keys(data),
                            datasets: [{
                                label: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤',
                                data: Object.values(data),
                                backgroundColor: ['#FF6384', '#FFCE56', '#36A2EB']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { display: false } }
                        }
                    });
                } catch (error) {
                    console.error('Error creating risk level chart:', error);
                }
            }

            createTermChart() {
                try {
                    const ctx = document.getElementById('termChart').getContext('2d');
                    const data = this.data.products.term_analysis;
                    
                    this.charts.termChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: Object.keys(data).map(key => `${key} –º–µ—Å.`),
                            datasets: [{
                                label: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤',
                                data: Object.values(data),
                                borderColor: '#2E8B57',
                                backgroundColor: 'rgba(46, 139, 87, 0.1)',
                                tension: 0.4,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: { y: { beginAtZero: true } }
                        }
                    });
                } catch (error) {
                    console.error('Error creating term chart:', error);
                }
            }

            showError(message) {
                const container = document.querySelector('.container');
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error';
                errorDiv.textContent = message;
                container.insertBefore(errorDiv, container.firstChild);
            }
        }

        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            // Create charts for the active tab
            if (window.zamanAnalytics) {
                window.zamanAnalytics.createTabCharts(tabName);
            }
        }

        // Initialize analytics when page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.zamanAnalytics = new ZamanAnalytics();
        });
    </script>
</body>
</html>